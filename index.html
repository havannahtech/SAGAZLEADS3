<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sagaz Motors â€“ CaptaÃ§Ã£o de Leads</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{--bg:#0b0b0b;--card:#151515;--red:#8b0000;--text:#fff}
.light{--bg:#f4f4f4;--card:#fff;--text:#111}
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:var(--bg);color:var(--text)}
.container{max-width:1100px;margin:auto;padding:16px}
.card{background:var(--card);padding:16px;border-radius:12px;margin-bottom:16px}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{background:var(--red);color:#fff;cursor:pointer}
.actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #333;font-size:13px}
.toggle{float:right;cursor:pointer}
canvas{max-height:300px}
.inline{display:grid;grid-template-columns:2fr 1fr;gap:8px}
</style>
</head>

<body>
<div class="container">
<div class="toggle" onclick="document.body.classList.toggle('light')">ðŸŒ™</div>

<h2>CaptaÃ§Ã£o de Leads â€“ Sagaz Motors</h2>

<div class="card">
<form id="form">

<!-- CATEGORIA -->
<select id="categoria" required>
<option value="">VeÃ­culo de Interesse</option>
<option>SCOOTER</option>
<option>HARLEY</option>
<option>TRICICLO</option>
<option>QUADRICICLO</option>
<option>TANK / CARGO</option>
<option>PATINETE</option>
<option>OUTROS</option>
</select>

<input id="nome" placeholder="Nome" required>
<input id="whatsapp" placeholder="WhatsApp (somente nÃºmeros)" required>

<!-- PRODUTO / MODELO -->
<input id="produto" placeholder="Modelo / Produto especÃ­fico">

<select id="origem" required>
<option value="">Origem do Lead</option>
<option>Instagram</option>
<option>TrÃ¡fego Pago</option>
<option>WhatsApp</option>
<option>Loja FÃ­sica</option>
<option>IndicaÃ§Ã£o</option>
<option>QR Code</option>
</select>

<!-- CEP + NUMERO -->
<div class="inline">
<input id="cep" placeholder="CEP" maxlength="8" onblur="buscarCEP()">
<input id="numero" placeholder="NÃºmero">
</div>

<input id="endereco" placeholder="EndereÃ§o completo" readonly>

<select id="voucher">
<option value="">Voucher (opcional)</option>
<option value="R$300">R$ 300</option>
<option value="R$500">R$ 500</option>
<option value="R$1000">R$ 1000</option>
<option value="R$1500">R$ 1500</option>
<option value="12x sem juros">12x sem juros</option>
<option value="18x sem juros">18x sem juros</option>
<option value="24x sem juros">24x sem juros</option>
</select>

<button type="submit">Salvar Lead</button>
</form>

<div class="actions">
<button onclick="whatsVoucher()">ðŸ“± Enviar Whats + Voucher</button>
<button onclick="exportar('dia')">CSV Hoje</button>
<button onclick="exportar('semana')">CSV Semana</button>
<button onclick="exportar('mes')">CSV MÃªs</button>
</div>
</div>

<div class="card">
<button onclick="gerarGrafico()">ðŸ“Š Gerar GrÃ¡fico</button>
<canvas id="grafico"></canvas>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Nome</th>
<th>Whats</th>
<th>Origem</th>
<th>Categoria</th>
<th>Produto</th>
<th>EndereÃ§o</th>
<th>Voucher</th>
</tr>
</thead>
<tbody id="lista"></tbody>
</table>
</div>

</div>

<script>
const KEY="sagazLeadsV22";
const ctx=document.getElementById("grafico");
let chart;

function get(){return JSON.parse(localStorage.getItem(KEY))||[]}
function save(d){localStorage.setItem(KEY,JSON.stringify(d))}

async function buscarCEP(){
const c=cep.value.replace(/\D/g,"");
if(c.length!==8)return;
const r=await fetch(`https://viacep.com.br/ws/${c}/json/`);
const d=await r.json();
if(d.erro)return alert("CEP nÃ£o encontrado");
const n=numero.value||"";
endereco.value=`${d.logradouro}, ${n} â€“ ${d.bairro} â€“ ${d.localidade}/${d.uf}`;
}

numero.onblur=()=>{ if(cep.value) buscarCEP(); }

form.onsubmit=e=>{
e.preventDefault();
const lead={
nome:nome.value,
whatsapp:whatsapp.value,
categoria:categoria.value,
produto:produto.value,
origem:origem.value,
endereco:endereco.value,
voucher:voucher.value,
data:new Date().toISOString(),
validadeVoucher:new Date(Date.now()+48*60*60*1000).toISOString()
};
const d=get(); d.push(lead); save(d);
form.reset(); render();
}

function render(){
lista.innerHTML="";
get().forEach(l=>{
lista.innerHTML+=`
<tr>
<td>${l.nome}</td>
<td>${l.whatsapp}</td>
<td>${l.origem}</td>
<td>${l.categoria}</td>
<td>${l.produto||"-"}</td>
<td>${l.endereco||"-"}</td>
<td>${l.voucher||"-"}</td>
</tr>`;
});
}
render();

function whatsVoucher(){
const l=get().slice(-1)[0];
if(!l)return;

let msg=`OlÃ¡ ${l.nome}! ðŸš€\nBem-vindo Ã  *Sagaz Motors*.\n\n`;

if(l.voucher){
msg+=`ðŸŽ *VOUCHER EXCLUSIVO*: ${l.voucher}\n`;
msg+=`â° *ATENÃ‡ÃƒO:* vÃ¡lido por *APENAS 48 HORAS* a partir de agora.\n\n`;
}

msg+=`ðŸ“ EndereÃ§o cadastrado:\n${l.endereco}\n\n`;
msg+=`ðŸ’° Simule agora seu parcelamento:\nhttps://havannahtech.github.io/PARCELAMENTO-SAGAZ-MOTORS/`;

window.open(`https://wa.me/55${l.whatsapp}?text=${encodeURIComponent(msg)}`);
}

function exportar(tipo){
const hoje=new Date();
let dados=get().filter(l=>{
const d=new Date(l.data);
if(tipo==="dia") return d.toDateString()===hoje.toDateString();
if(tipo==="semana") return (hoje-d)/(1000*60*60*24)<=7;
if(tipo==="mes") return d.getMonth()===hoje.getMonth();
});
let csv="Nome,Whats,Origem,Categoria,Produto,Endereco,Voucher\n";
dados.forEach(l=>csv+=`${l.nome},${l.whatsapp},${l.origem},${l.categoria},${l.produto},"${l.endereco}",${l.voucher}\n`);
const a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([csv]));
a.download=`leads-${tipo}.csv`;
a.click();
}

function gerarGrafico(){
const dados=get();
const contagem={};
dados.forEach(l=>{
const d=new Date(l.data).toLocaleDateString();
contagem[d]=(contagem[d]||0)+1;
});
if(chart)chart.destroy();
chart=new Chart(ctx,{
type:'bar',
data:{labels:Object.keys(contagem),datasets:[{label:'Leads',data:Object.values(contagem)}]}
});
}
</script>
</body>
</html>
